

/////////////////////////////////////////////

//mydata = [{"id":"1","abbr":"AL","state":"Alabama","population":"4849377","Population_60_plus":"21.4","heartattack":"5.9","skin_cancer":"8.2","Binge Drinker":"12","smokers":"21.1"},{"id":"2","abbr":"AK","state":"Alaska","population":"736732","Population_60_plus":"15.1","heartattack":"3.3","skin_cancer":"3.2","Binge Drinker":"20.2","smokers":"19.9"},{"id":"3","abbr":"AZ","state":"Arizona","population":"6731484","Population_60_plus":"21.7","heartattack":"4.4","skin_cancer":"8.3","Binge Drinker":"14.9","smokers":"16.5"},{"id":"4","abbr":"AR","state":"Arkansas","population":"2966369","Population_60_plus":"21.8","heartattack":"6.7","skin_cancer":"6.6","Binge Drinker":"13.3","smokers":"24.7"},{"id":"5","abbr":"CA","state":"California","population":"38802500","Population_60_plus":"18.2","heartattack":"3.5","skin_cancer":"4.8","Binge Drinker":"15.6","smokers":"12.9"},{"id":"6","abbr":"CO","state":"Colorado","population":"5355866","Population_60_plus":"18.7","heartattack":"3.1","skin_cancer":"6.3","Binge Drinker":"17.5","smokers":"15.7"},{"id":"7","abbr":"CT","state":"Connecticut","population":"3596677","Population_60_plus":"21.6","heartattack":"3.7","skin_cancer":"5.8","Binge Drinker":"15.9","smokers":"15.4"},{"id":"8","abbr":"DE","state":"Delaware","population":"935614","Population_60_plus":"22.4","heartattack":"5","skin_cancer":"6.7","Binge Drinker":"15.7","smokers":"19.9"},{"id":"9","abbr":"DC","state":"District of Columbia","population":"658893","Population_60_plus":"16.3","heartattack":"2.6","skin_cancer":"2.9","Binge Drinker":"24.9","smokers":"16.4"},{"id":"10","abbr":"FL","state":"Florida","population":"19893297","Population_60_plus":"25.3","heartattack":"5.3","skin_cancer":"8.9","Binge Drinker":"15","smokers":"17.7"},{"id":"11","abbr":"GA","state":"Georgia","population":"10097343","Population_60_plus":"17.9","heartattack":"4.5","skin_cancer":"6.4","Binge Drinker":"14.2","smokers":"17.4"},{"id":"12","abbr":"HI","state":"Hawaii","population":"1419561","Population_60_plus":"22.2","heartattack":"3.1","skin_cancer":"4.5","Binge Drinker":"19.7","smokers":"14.1"},{"id":"13","abbr":"ID","state":"Idaho","population":"1634464","Population_60_plus":"20.4","heartattack":"3.7","skin_cancer":"7.1","Binge Drinker":"14.8","smokers":"15.9"},{"id":"14","abbr":"IL","state":"Illinois","population":"12880580","Population_60_plus":"19.7","heartattack":"3.7","skin_cancer":"4.2","Binge Drinker":"20.2","smokers":"16.5"},{"id":"15","abbr":"IN","state":"Indiana","population":"6596855","Population_60_plus":"20.3","heartattack":"5","skin_cancer":"5.6","Binge Drinker":"14.8","smokers":"22.9"},{"id":"16","abbr":"IA","state":"Iowa","population":"3107126","Population_60_plus":"22","heartattack":"4.4","skin_cancer":"5.9","Binge Drinker":"21.4","smokers":"18.5"},{"id":"17","abbr":"KS","state":"Kansas","population":"2904021","Population_60_plus":"20.2","heartattack":"4.2","skin_cancer":"6.2","Binge Drinker":"15.8","smokers":"18.1"},{"id":"18","abbr":"KY","state":"Kentucky","population":"4413457","Population_60_plus":"20.9","heartattack":"6.8","skin_cancer":"7.7","Binge Drinker":"12.7","smokers":"26.2"},{"id":"19","abbr":"LA","state":"Louisiana","population":"4649676","Population_60_plus":"19.5","heartattack":"5.2","skin_cancer":"5","Binge Drinker":"16","smokers":"24"},{"id":"20","abbr":"ME","state":"Maine","population":"1330089","Population_60_plus":"25.7","heartattack":"5.5","skin_cancer":"6.9","Binge Drinker":"17","smokers":"19.3"},{"id":"21","abbr":"MD","state":"Maryland","population":"5976407","Population_60_plus":"19.6","heartattack":"3.2","skin_cancer":"4.9","Binge Drinker":"15.4","smokers":"14.6"},{"id":"22","abbr":"MA","state":"Massachusetts","population":"6745408","Population_60_plus":"21.2","heartattack":"4.1","skin_cancer":"6.3","Binge Drinker":"17.4","smokers":"14.7"},{"id":"23","abbr":"MI","state":"Michigan","population":"9909877","Population_60_plus":"22","heartattack":"5.2","skin_cancer":"5.8","Binge Drinker":"18.9","smokers":"21.2"},{"id":"24","abbr":"MN","state":"Minnesota","population":"5457173","Population_60_plus":"20.2","heartattack":"3.8","skin_cancer":"5.1","Binge Drinker":"19.5","smokers":"16.3"},{"id":"25","abbr":"MS","state":"Mississippi","population":"2994079","Population_60_plus":"20.1","heartattack":"4.9","skin_cancer":"5.7","Binge Drinker":"12.8","smokers":"23"},{"id":"26","abbr":"MO","state":"Missouri","population":"6063589","Population_60_plus":"21.5","heartattack":"5.4","skin_cancer":"6","Binge Drinker":"15.1","smokers":"20.6"},{"id":"27","abbr":"MT","state":"Montana","population":"1023579","Population_60_plus":"23.5","heartattack":"4.2","skin_cancer":"6.8","Binge Drinker":"18.9","smokers":"19.9"},{"id":"28","abbr":"NE","state":"Nebraska","population":"1881503","Population_60_plus":"20.1","heartattack":"3.8","skin_cancer":"5.7","Binge Drinker":"20.3","smokers":"17.3"},{"id":"29","abbr":"NV","state":"Nevada","population":"2839099","Population_60_plus":"19.9","heartattack":"4.8","skin_cancer":"6.3","Binge Drinker":"16","smokers":"17"},{"id":"30","abbr":"NH","state":"New Hampshire","population":"1326813","Population_60_plus":"22.8","heartattack":"3.8","skin_cancer":"6.3","Binge Drinker":"16.8","smokers":"17.5"},{"id":"31","abbr":"NJ","state":"New Jersey","population":"8938175","Population_60_plus":"20.6","heartattack":"4.2","skin_cancer":"4.8","Binge Drinker":"15.8","smokers":"15.1"},{"id":"32","abbr":"NM","state":"New Mexico","population":"2085572","Population_60_plus":"21.6","heartattack":"4.2","skin_cancer":"5.2","Binge Drinker":"13.7","smokers":"19.2"},{"id":"33","abbr":"NY","state":"New York","population":"19746227","Population_60_plus":"20.6","heartattack":"3.8","skin_cancer":"4.1","Binge Drinker":"15","smokers":"14.4"},{"id":"34","abbr":"NC","state":"North Carolina","population":"9943964","Population_60_plus":"20.5","heartattack":"5.1","skin_cancer":"6.6","Binge Drinker":"13.6","smokers":"19.1"},{"id":"35","abbr":"ND","state":"North Dakota","population":"739482","Population_60_plus":"20","heartattack":"4.6","skin_cancer":"4.4","Binge Drinker":"24","smokers":"19.9"},{"id":"36","abbr":"OH","state":"Ohio","population":"11594163","Population_60_plus":"21.8","heartattack":"5.4","skin_cancer":"6","Binge Drinker":"18.1","smokers":"21"},{"id":"37","abbr":"OK","state":"Oklahoma","population":"3878051","Population_60_plus":"20.1","heartattack":"5.5","skin_cancer":"5.9","Binge Drinker":"12.9","smokers":"21.1"},{"id":"38","abbr":"OR","state":"Oregon","population":"3970239","Population_60_plus":"22.9","heartattack":"4.6","skin_cancer":"7.4","Binge Drinker":"16.6","smokers":"17"},{"id":"39","abbr":"PA","state":"Pennsylvania","population":"12787209","Population_60_plus":"23.2","heartattack":"4.8","skin_cancer":"6.1","Binge Drinker":"16.7","smokers":"19.9"},{"id":"40","abbr":"RI","state":"Rhode Island","population":"1055173","Population_60_plus":"22.1","heartattack":"4.3","skin_cancer":"6.3","Binge Drinker":"18.4","smokers":"16.3"},{"id":"41","abbr":"SC","state":"South Carolina","population":"4832482","Population_60_plus":"22.2","heartattack":"4.6","skin_cancer":"7.2","Binge Drinker":"14.1","smokers":"21.5"},{"id":"42","abbr":"SD","state":"South Dakota","population":"853175","Population_60_plus":"21.2","heartattack":"5.1","skin_cancer":"6.1","Binge Drinker":"17.4","smokers":"18.6"},{"id":"43","abbr":"TN","state":"Tennessee","population":"6549352","Population_60_plus":"21.2","heartattack":"5.7","skin_cancer":"6.8","Binge Drinker":"10.6","smokers":"24.2"},{"id":"44","abbr":"TX","state":"Texas","population":"26956958","Population_60_plus":"16.5","heartattack":"3.7","skin_cancer":"4.6","Binge Drinker":"16.3","smokers":"14.5"},{"id":"45","abbr":"UT","state":"Utah","population":"2942902","Population_60_plus":"14.6","heartattack":"2.9","skin_cancer":"6.6","Binge Drinker":"11.4","smokers":"9.7"},{"id":"46","abbr":"VT","state":"Vermont","population":"626562","Population_60_plus":"24.1","heartattack":"3.8","skin_cancer":"6.4","Binge Drinker":"17.9","smokers":"16.4"},{"id":"47","abbr":"VA","state":"Virginia","population":"8326289","Population_60_plus":"19.7","heartattack":"4.2","skin_cancer":"5.5","Binge Drinker":"15.2","smokers":"19.5"},{"id":"48","abbr":"WA","state":"Washington","population":"7061530","Population_60_plus":"20.1","heartattack":"3.8","skin_cancer":"5.8","Binge Drinker":"17.1","smokers":"15.3"},{"id":"49","abbr":"WV","state":"West Virginia","population":"1850326","Population_60_plus":"24.9","heartattack":"7.4","skin_cancer":"7.6","Binge Drinker":"9.6","smokers":"26.7"},{"id":"50","abbr":"WI","state":"Wisconsin","population":"5757564","Population_60_plus":"21.6","heartattack":"3.7","skin_cancer":"5.5","Binge Drinker":"22.1","smokers":"17.4"},{"id":"51","abbr":"WY","state":"Wyoming","population":"584153","Population_60_plus":"20.7","heartattack":"4.6","skin_cancer":"7.5","Binge Drinker":"17.2","smokers":"19.5"},{"id":"52","abbr":"PR","state":"Puerto Rico","population":"3548397","Population_60_plus":"23.5","heartattack":"5.3","skin_cancer":"1.3","Binge Drinker":"13.2","smokers":"11.3"}]

  mydata.forEach(function(d) {
	d.x = -1 ; 
	d.y =  -1 ;
	d.x0 =   +d.population ;
	d.x1 =  +d.Population_60_plus;
    d.y0 =  +d.heartattack;
	d.y1 =  +d.skin_cancer;
	d.d1 =  d.state;
	d.d2 =  d.abbr;
  });

// setup the data ///////////////////////////////////////////////////////////////////////


v_x0_title = 'Total Population'
v_x1_title = 'Percentage of people 60 +'
v_y0_title = 'Percentage of Heartattack at least 1 time'
v_y1_title = 'Percentage of diagnosed with skin cancer'


v_x0_name = 'Population'
v_x1_name= '% 60 plus'
v_y0_name = '% Heart attack'
v_y1_name= '% Skin cancer'


v_x_group_title = 'Demographics'
v_y_group_title = 'Risk Factors'


v_color_dict = { 'x0y0' : 'skyblue' , 'x0y1' : 'pink' , 'x1y0' : 'gold','x1y1' : 'lime'}



// setting up initial x and y 
mydata.forEach( function (d,i){
  d.x =   d.x0;
  d.y =   d.y0;
}) ;

// adding tooltip on fly on mydata
mydata.forEach( function (d,i){
  d.xy_tooltip =  '<strong>' +d.d1 + '<strong><hr>' + v_x0_name +': ' + d.x + '<br>' + v_y0_name +': ' + d.y
}) ;



// resize window logic ///////////////////////////////////////////////////////////////////////

// When the browser window is resized, responsify() is called.
d3.select(window).on("resize", makeResponsive);
// When the browser loads, makeResponsive() is called.
makeResponsive();
// The code for the chart is wrapped inside a function
// that automatically resizes the chart
function makeResponsive() {
  // if the SVG area isn't empty when the browser loads, remove it
  // and replace it with a resized version of the chart
  var svgArea = d3.select("body").select("svg");
  if (!svgArea.empty()) {
    svgArea.remove();
  };
  // SVG wrapper dimensions are determined by the current width
  // and height of the browser window.
  var svgWidth = window.innerWidth;
  var svgHeight = window.innerHeight;

  // below can be dynamic by using window.innerHeight   window.innerwidth

  v_plot_area_height = svgHeight ; //500;
  v_plot_area_width = svgWidth -100; //700;

  margin = { left: 100, right: 50 ,  bottom: 50, top: 50};

  height = v_plot_area_height - margin.top - margin.bottom -70  ;
  width = v_plot_area_width - margin.left - margin.right ;

  x_min_target = 0; // this is starting position
  x_max_target= width //300; // this is v_plot_area_width minus margins

  y_min_target = height //500; // (v_plot_area_height minus margins)
  y_max_target= 0;  // this is starting position (upside down by default that is why x , y switched) 

 // DOM logic ///////////////////////////////////////////////////////////////////////////////////////////

  // Select body, append SVG area to it, and set its dimensions
  $d3_base = d3.select("body").append("svg");
  $d3_base.attr("width", v_plot_area_width).attr("height", v_plot_area_width);


  // Append a group area, then set its margins
  var $d3_group = $d3_base.append("g")
  .attr("transform", `translate(${margin.left}, ${margin.top})`);

  //titles/////////////////////////////////////////////////////////////////////////////////////////////

  // x titles 

  t1_location_x = width/2
  t1_location_y = y_min_target + margin.top + 20

  $d3_group.append("text")
    .attr("transform",`translate(${t1_location_x}, ${t1_location_y})`)
    .classed("x-label", true)
    .style("text-anchor" , 'middle')
    .attr("value", "x0") //value to grab for event listener
    .style("fill" ,  'black')
    .text(v_x0_title);

  t2_location_x = width/2
  t2_location_y = y_min_target + margin.top + 40

  $d3_group.append("text")
    .attr("transform",`translate(${t2_location_x}, ${t2_location_y})`)
    .classed("x-label", true)
    .style("text-anchor" , 'middle')
    .attr("value", "x1") //value to grab for event listener
	.style("fill" ,  'lightgray')
    .text(v_x1_title);

  // y titles 

  t1_location_x = - 30
  t1_location_y = height/2


  $d3_group.append("text")
    .attr("transform",`translate(${t1_location_x}, ${t1_location_y})rotate(270)`)
    .classed("y-label", true)
    .style("text-anchor" , 'middle')
    .attr("value", "y0") //value to grab for event listener
    .style("fill" ,  'black')
    .text(v_y0_title);

  t1_location_x = - 50
  t1_location_y = height/2


  $d3_group.append("text")
    .attr("transform",`translate(${t1_location_x}, ${t1_location_y})rotate(270)`)
    .classed("y-label", true)
    .style("text-anchor" , 'middle')
    .attr("value", "y1") //value to grab for event listener
	.style("fill" ,  'lightgray')
    .text(v_y1_title);

  t1_location_x = width - 100
  t1_location_y = height -5

	
    $d3_group.append("text")
        .attr("transform", `translate(${t1_location_x},${t1_location_y})`)
        .attr("class", "axis-text-main")
        .text(v_x_group_title)

  t1_location_x = 15
  t1_location_y =  margin.top + 50
		
    $d3_group.append("text")
        .attr("transform", `translate(${t1_location_x},${t1_location_y} )rotate(270)`)
        .attr("class", "axis-text-main")
        .text(v_y_group_title)
		
		
 
 //Defining axis/////////////////////////////////////////////////////////////////////////////////////////////

  $d3_group_xaxis = $d3_group.append("g").classed("axis", true).attr("transform", `translate(0, ${y_min_target})`);

  $d3_group_yaxis = $d3_group.append("g").classed("axis", true);

 // Useful functions ///////////////////////////////////////////////////////////////////////////////////////////////////////////	  
// for syncing merge of data 
  function sync($e_binded , v_append) {

    $e_binded
      .enter()
      .append(v_append)
      .merge($e_binded)
      .text(function (d) {return d;} ) 
    ;

    $e_binded.exit().remove();
  };


 // default values ///////////////////////////////////////////////////////////////////////////////////////////////////////////

  //  default values 	
  x_current_value = 'x0'
  y_current_value = 'y0'	
  fx_plot_me (x_current_value,y_current_value ) ;


  
  //function to plot/////////////////////////////////////////////////////////////////////////////////////////////////////////

  function fx_plot_me(x_current_value, y_current_value ){
  //determining which are the values for x and y ///////////////////////
    $d3_current_group = $d3_group;
    mydata.forEach( function (d,i){
      if ( x_current_value == 'x0' && y_current_value == 'y0') {
        d.x =   d.x0;
        d.y =   d.y0;
		v_circle_color = v_color_dict['x0y0']
         mydata.forEach( function (d,i){d.xy_tooltip =  '<strong>' +d.d1 + '<strong><hr>' + v_x0_name +': ' + d.x + '<br>' + v_y0_name +': ' + d.y    }) ;
      }
      if ( x_current_value == 'x0' && y_current_value == 'y1') {
        d.x =   d.x0;
        d.y =   d.y1;
		v_circle_color = v_color_dict['x0y1']
	     mydata.forEach( function (d,i){ d.xy_tooltip =  '<strong>' +d.d1 + '<strong><hr>' + v_x0_name +': ' + d.x + '<br>' + v_y1_name +': ' + d.y    }) ;
      }
      if ( x_current_value == 'x1' && y_current_value == 'y0') {
        d.x =   d.x1;
        d.y =   d.y0;
		v_circle_color = v_color_dict['x1y0']
	     mydata.forEach( function (d,i){d.xy_tooltip =  '<strong>' +d.d1 + '<strong><hr>' + v_x1_name +': ' + d.x + '<br>' + v_y0_name +': ' + d.y    }) ;
      }
      if ( x_current_value == 'x1' && y_current_value == 'y1') {
        d.x =   d.x1;
        d.y =   d.y1;
		v_circle_color = v_color_dict['x1y1']
	     mydata.forEach( function (d,i){d.xy_tooltip =  '<strong>' +d.d1 + '<strong><hr>' + v_x1_name +': ' + d.x + '<br>' + v_y1_name +': ' + d.y    }) ;
      }
    }) ;




    // scaling logic ///////////////////////////////////////////////

    v_input_list_x = mydata.map(d => d.x);
    v_input_list_y = mydata.map(d => d.y);
	v_max_x = d3.max(v_input_list_x)
	v_max_y = d3.max(v_input_list_y)
	v_min_x = d3.min(v_input_list_x)
	v_min_y = d3.min(v_input_list_y)
	v_10_x = Math.ceil((v_max_x -v_min_x)/10)
    v_10_y = Math.ceil((v_max_y -v_min_y)/10)

    fx_x_scaled = d3.scaleLinear().domain([v_min_x -v_10_x, v_max_x + v_10_x]).range([x_min_target,x_max_target]);
    fx_y_scaled = d3.scaleLinear().domain([v_min_y -v_10_y, v_max_y + v_10_y]).range([y_min_target,y_max_target]);

    //axes/////////////////////////////////////////////////////////

    // to start x axis at y_min_target length we need translate 
    $d3_group_xaxis
      .transition()
      .duration(1000)
      .ease(d3.easeLinear)
      .call(d3.axisBottom(fx_x_scaled));

    $d3_group_yaxis
      .transition()
      .duration(1000)
      .ease(d3.easeLinear)
      .call(d3.axisLeft(fx_y_scaled));		

    //drawing circles ////////////////////////////////////////////////


    $d3_circle_binded = $d3_current_group.selectAll("circle")
      .data(mydata)


    sync($d3_circle_binded , 'circle');

    // create circles 	  	  
    $d3_circle_binded_stage_xy =$d3_circle_binded
    //.append("circle")
      .transition()
      .duration(1000)
      .ease(d3.easeLinear)
      .attr("cx", d => fx_x_scaled(d.x))
      .attr("cy", d => fx_y_scaled(d.y))
      .attr("r", "10")
      .attr("fill", v_circle_color)
      //.attr("stroke-width", "1")
      //.attr("stroke", "black")	

    //circles text ////////////////////////////////////////////////

    mydata.forEach( function (d,i){
	  $d3_circle_binded1	 =  $d3_current_group.append("text").classed("circle_text", true)
        .text(function (d) {return 'xxx';} ) 
              ;

    });
	
    $d3_circle_binded1	 =  $d3_current_group.selectAll("text")
	                       .filter(function(d, i) { console.log(this) ; return d3.select(this).attr("class") == 'circle_text'; })
                          .data(mydata)
						  
    sync($d3_circle_binded1 , 'text');

    $d3_circle_binded_stage1_xy = $d3_circle_binded1
	  .classed("circle_text", true)
	        .transition()
      .duration(1000)
      .ease(d3.easeLinear)
      .attr("x", d => fx_x_scaled(d.x))
      .attr("y", d => fx_y_scaled(d.y))
      .attr("font-size", "10px")
      .attr("text-anchor", "middle")
      .text(function (d) {
      //return 'nish'
      return d.d2;
    }) ; 

    // create function to create tooltipcontainer on fly //////////////////////

    fx_tip_xy = d3.tip()
      .attr("class", "tooltip1")
      .offset([80, -60])
      .html(function(d,i){
      //console.log('xxxxxx');
      //return ('xx dd: <strong>gg</strong>');
      return (`${d.xy_tooltip}`)
    }
           );
		   
    // Create the tooltip in chartGroup.
    $d3_current_group.call(fx_tip_xy)

    // Create "mouseover" event listener to display tooltip
    $d3_circle_binded.on("mouseover", function(d){
      fx_tip_xy.show(d)
    })
    //Create "mouseout" event listener to hide tooltip
      .on("mouseout", function(d){
      fx_tip_xy.hide(d)
    });


    // Create "mouseover" event listener to display tooltip
    $d3_circle_binded1.on("mouseover", function(d){
      fx_tip_xy.show(d)
    })
    //Create "mouseout" event listener to hide tooltip
      .on("mouseout", function(d){
      fx_tip_xy.hide(d)
    });

    ////plot logic end /////////////////////////


  };


  ////clicking labels logic /listener///////////////////////////////////////////////////////////////////////////////////////

  //  clicking labels logic 	
  $d3_group.selectAll("text")
    .on("click", 
        function () {	  
    my_value = d3.select(this).attr("value")
    my_class = d3.select(this).attr("class") 


    if (my_class == 'x-label'){
      x_current_value = my_value;
      d3.selectAll('.x-label').style("fill" ,  'lightgray')	  
      d3.select(this).style("fill" ,  'black')
      //console.log(this)	  
    }
    else {
      y_current_value = my_value;
      d3.selectAll('.y-label').style("fill" ,  'lightgray')	  
      d3.select(this).style("fill" ,  'black')
      //console.log(this)
    }
	
    fx_plot_me(x_current_value, y_current_value );

  });


////default call///////////////////////////////////////////////////////////////////////////////////////

  fx_plot_me (x_current_value,y_current_value,v_circle_color ) ;

  //            	  
  //end of makeResponsive below
}